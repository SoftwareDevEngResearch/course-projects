## Integrating Field Programmable Gate Arrays with Python for Radiation Detection ##
<p align="justify">
The Radiation Detection Group at Oregon State University utilizes FPGAs for all digital pulse processing needs. FPGAs can be reprogrammed with unique bitfiles generated form a hardware description language(HDL), which maximizes design flexibility. A commercial off the shelf FPGA board from Opal Kelly is connected to an 8-channel digital pulse processor designed by the radiation detection lab group and is seen in the following figure. The DPP8 was designed for use in multiple detection projects including radio-xenon detection and characterizing special nuclear material. All analog pulses, mostly from radiation detectors, connected to the DPP8 are digitized before entering the DPP8.

<center><img src="https://i.imgur.com/ioiDOSf.jpg" width="40%" align="middle">

**8-Channel Digital Pulse Processor(DPP8) [1]**</center>

<p align="justify">
Opal Kelly provides API packages for several coding languages including MATLAB, Python, and C/C++. The API serves as a protocol to send and receive data directly from the FPGA to the PC via USB-3. Currently, all processing scripts are written via MATLAB. Opal Kelly has stopped API support for MATLAB, which may result in data processing conflicts in future projects. All modes that are implemented in MATLAB will be translated into Python with some additional functionality for select modes. These include oscilloscope, histogram, coincidence, listogram, and offset calibration modes.

<p align="justify">
Oscilloscope mode provides real time data of the current analog pulse connected to the DPP8. Data provided includes time length of the pulse and relative amplitude. A potential functionality to be including in the software package is to analyze the fast and slow components of each pulse, which can be used to determine if pulse shape discrimination is possible. 

<p align="justify">
Histogram mode provides the gamma spectrum generated by a radiation detector. The graph is updated in real-time and provides real- and live-time information for the current measurement. The updated python package will provide the capability to identify the location of each peak. Once each peak is located a calibration curve will be generated to correlate channel number and energy information. 

<p align="justify">
Coincidence mode is utilized when multiple detectors are connected to the DPP8. A timing window is established in the FPGA, on the order of microseconds, and if two interactions occur in designated detectors within the timing window a coincidence has occurred. Beta-gamma coincidences can be used to determine if a nuclear weapon has been detonated.[2] The python script will determine which channels should be in coincidence and integrate the saved pulses to determined energy deposition. An additional feature will incorporate the DDR3 memory device located on the Opal Kelly board. This method will be quicker in saving pulse data and will provide an option to save additional information such as time stamp, energy deposited, and DPP8 channel number. 

<p align="justify">
Listogram provides temporal information of the histogram. A user set time-value produces time slices of the histogram. Coarsening of the data has been conducted previously to characterize material quantities of aluminum and dysprosium as well as special nuclear material.[3],[4] Matrix analysis has been conducted in R to determine material quantities from listogram data. This data analysis will be translated to Python with the additional functionality of providing real-time analysis as the data is being streamed from the FPGA. Software will also provide information concerning the live and dead time for each time slice of the histogram.

<p align="justify">
Offset calibration will be a new feature that has not been developed in MATLAB. The analog to digital board has a digital to analog chip (DAC) to adjust the voltage offset of an incoming analog pulse. Python will continuously monitor the incoming pulse to determine the polarity of the pulse and whether the pulse is at the appropriate baseline. The feature will ensure that the incoming pulses are achieving the maximum usage of the dynamic range of the on-board analog to digital chip (ADC).

<p align="justify">
The Opal-Kelly API python package will be the main package used for this project. All python functions in this package determines how data is being transferred between the FPGA and computer. Other important packages include numpy, matplotlib, and scipy to perform all data analysis on data and to illustrate the data in  the several modes. A final goal of this project is to coalesce all functionality into a graphical user interface using the wxPython package.  

<p align="justify">
A stretch goal for this project to to provide internet connectivity to the system. A user on the web would be able to monitor streaming data and conduct analysis remotely. 

<p align="justify">
A complete python package will be essential to the radiation detection lab group  at Oregon State since all previous data acquisition from the FPGA was conducted in MATLAB, which is no longer supported by Opal Kelly. Researchers developing radiation detection systems can utilize this package with some minor changes to acquire the desired data for their research.


# **REFERENCES** #
 
[1] C. Lee, "Design of an 8-channel digital pulse processor. 2015

[2] S. Czyz "A Compact Radioxenon Detection System Using CZT, an Array of SiPMs, and a Plastic Scintillator," 2016

[3] M. Mannino "Real Time Temporal Spectroscopy for Characterizing Special Nuclear Material," 2017

[4] R. S. Williford, “Temporal gamma-ray spectrometry to quantify relative fissile material content,” Oregon State University, 2013.



